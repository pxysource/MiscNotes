# VI编辑器的三种模式

## 命令模式

- 用户在用vi编辑器时，最初进入的模式，可以进行复制、粘贴等操作。

### 按键

- ESC：进入命令状态。
- r修改光标所在的字符，r之后接跟你要修正的字符（比如你要把fox中的o改成i，只需将光标停在o上，接着连续按下r和i）。

## 插入模式

- 进行文件编辑，按ESC键可以回到命令行模式。

### 按键

- a：（append）进入编辑状态，从当前光标之后开始插入键盘输入的字符。
- i：（insert）进入编辑状态，从当前光标的位置开始插入键盘输入的字符。
- o：（open）进入编辑状态，并插入一新行，光标移动到新行的行首，从当前光标的位置开始插入键盘输入的字符。
- I：光标移动到行首，等待插入。
- A：光标移动到行尾，等待插入。
- O：在当前行之上插入新行，等待插入。

## 底行模式

- 光标位于屏幕的底行。可以进行文件的保存、退出、查找、替换、列出行号等。

### 按键

- 在命令模式下，:可以进行底行模式。

- ：！ Command：在vi执行外部命令command，按回车键可以返回vi继续工作。

# VI键盘

![VI键盘](Common/vi_keyboard.png)

## 常用快捷键

| 命令（或则键） | 作用                                   | 备注 |
| -------------- | -------------------------------------- | ---- |
| x              | 删除光标处的字符。                     |      |
| dd             | 删除整行。                             |      |
| i              | 在光标前插入文本。                     |      |
| a              | 在光标后插入文本。                     |      |
| o              | 当前行下插入新行。                     |      |
| u              | 撤销最后一次修改。                     |      |
| :e!            | 放弃所有修改，从上次保存开始处再编辑。 |      |
| :wq            | 保存退出。                             |      |
| :q!            | 不保存退出。                           |      |
| /pattern       | 从光标开始处向文件尾搜索pattern。      |      |
| ?pattern       | 从光标开始处向文件首搜索pattern。      |      |

## 光标控制命令

| 键        | 作用                               | 备注 |
| --------- | ---------------------------------- | ---- |
| h         | 向左移一个字符。                   |      |
| j         | 向下移一行。                       |      |
| k         | 向上移一行。                       |      |
| l或空格   | 向右移一个字符。                   |      |
| G         | 移到文件的最后一行。               |      |
| nG        | 移到文件的第n行。                  |      |
| w         | 移到下一个字的开头。               |      |
| W         | 移到下一个字的开头，忽略标点符号。 |      |
| b         | 移到前一个字的开头。               |      |
| B         | 移到前一个字的开头，忽略标点符号。 |      |
| L         | 移到屏幕的最后一行。               |      |
| M         | 移到屏幕的中间一行。               |      |
| H         | 移到屏幕的第一行。                 |      |
| e         | 移到下一个字的结尾。               |      |
| E         | 移到下一个字的结尾，忽略标点符号。 |      |
| (         | 移到句子的开头。                   |      |
| )         | 移到句子的结尾。                   |      |
| {         | 移到段落的开头。                   |      |
| 0或\|     | 移到当前行的第一列。               |      |
| n\|       | 移到当前行的第n列。                |      |
| ^         | 移到当前行的第一个非空字符。       |      |
| $         | 移到当前行的最后一个字符。         |      |
| +或return | 移到下一行的第一个字符。           |      |
| \-        | 移到前一行的第一个非空字符。       |      |

## 在VI中添加文本

| 键（或则命令） | 作用                                             | 备注                                               |
| -------------- | ------------------------------------------------ | -------------------------------------------------- |
| a              | 在光标后插入文本。                               |                                                    |
| A              | 在当前行插入文本。                               |                                                    |
| i              | 在光标前插入文本。                               |                                                    |
| I              | 在当前行前插入文本。                             |                                                    |
| o              | 在当前行的下边插入新行。                         |                                                    |
| O              | 在当前行的上边插入新行。                         |                                                    |
| :r file        | 读入文件file内容，并插在当前行后。               |                                                    |
| :nr file       | 读入文件file内容，并插在第n行后。                |                                                    |
| escape         | 回到命令模式。                                   |                                                    |
| ^v char        | 插入时忽略char的指定意义，这是为了插入特殊字符。 | 插入模式，按下ctrl + v，按下按键，可插入特殊字符。 |

## 在VI中删除文本

| 键（或则命令）  | 作用                                                 | 备注              |
| --------------- | ---------------------------------------------------- | ----------------- |
| x               | 删除光标处的字符，可以在x前加上需要删除的字符数目。  |                   |
| nx              | 从当前光标处往后删除n个字符。                        |                   |
| X               | 删除光标前的字符，可以在X前加上需要删除的字符数目。  |                   |
| nX              | 从当前光标处往前删除n个字符。                        |                   |
| dw              | 删至下一个字的开头。                                 |                   |
| ndw             | 从当前光标处往后删除n个字。                          |                   |
| dG              | 删除行，直到文件结束。                               |                   |
| dd              | 删除整行。                                           |                   |
| ndd             | 从当前行开始往后删除。                               |                   |
| db              | 删除光标前面的字。                                   |                   |
| ndb             | 从当前行开始往前删除n字。                            |                   |
| :n,md           | 从第m行开始往前删除n行。                             |                   |
| d或d$           | 从光标处删除到行尾。                                 | d按键达不到效果。 |
| dcursor_command | 删除至光标命令处，如dG将从当产胆行删除至文件的末尾。 |                   |
| ^h或backspace   | 插入时，删除前面的字符                               | ^为Ctrl键。       |
| ^w              | 插入时，删除前面的字。                               |                   |

## 修改VI文本

- 每个命令前面的数字表示该命令的重复次数。

| 键（或则命令）          | 作用                                     | 备注 |
| ----------------------- | ---------------------------------------- | ---- |
| rchar                   | 用char替换当前字符。                     |      |
| R text escape           | 用text替换当前字符直到换下Esc键。        |      |
| stext escape            | 用text代替当前字符。                     |      |
| S或cctext escape        | 用text代替整行。                         |      |
| cwtext escape           | 将当前字改为text。                       |      |
| Ctext escape            | 将当前行余下的改为text。                 |      |
| cG escape               | 修改至文件的末尾。                       |      |
| ccursor_cmd text escape | 从当前位置处到光标命令位置处都改为text。 |      |

## 在VI中查找与替换



# 基本操作

## VI保存和退出命令

- ：q （quit）退出没有修改的文件（若文件被修改，且没有保存，则此命令无效）。
- ：q！强制退出，且不保存修改过的部分。
- ：w（write）保存文件，但不退出。
- ：x （Exit）保存文件并退出。
- ：w File 另存为file给出的文件名，不退出。
- ：r File （read）读入file指定的文件内容插入当前光标位置。
- :   wq保存文件并退出。

## vi拷贝与粘贴命令

- [N]x（Expurgate）删除从光标位置开始的连续N个字符（并复制到编辑缓冲区）。
- [N]dd（Delete）删除从光标位置开始的连续N行（并复制到编辑缓冲区）。
- [N]yy（Yank）复制从光标位置开始的连续N行到编辑缓冲区。
- P或p（Put）从编辑缓冲区复制文本到当前光标处（即粘贴）。
- u（Undo）取消上一次操作（即恢复功能）。
- 按Ctrl+r恢复撤销掉的操作。

## vi光标移动命令

- h：方向键，向左移动光标一个字符的位置，相当于键“←”。
- j：方向键，向下移动光标到下一行的位置，相当于“↓”。
- k：方向键，向上移动光标到上一行的位置，相当于“↑”。
- l：方向键，向右移动光标一个字符 的位置，相当于“→”。
- ：N：移动光标到第N行（N待定）。
- 1G：移动光标到文件的第1行。
- G：移动光标到文件的最后1行。
- gg跳到文本的最初一行。
- Ctrl+u向上(up)翻页。
- Ctrl+d向下(down)翻页。

## 显示行号

- ：set number：设置显示行号。
- ：set nonumber：取消显示行号。

## VI的查找命令

- /string查找字符串

  n继续查找

  N方向继续查找

  支持正则表达式比如：/^the    /end

- ?string跟上面的"/string"是一样的，区别是它从光标处往上查找。

## VI的替换命令

- 利用：s命令可以实现字符串的替换

  ：（范围）s/（old）/（new）  g：代表全部替换

  ：s/str1/str2/（当前行）

  ：s/str1/str2/g（）

  ：.,$s/str1/str2/g（当前行到最后一行）

  ：1,$s/str1/str2/g（第一行到最后一行，也就是全文）

  ：%s/str1/str2/g（全文）

## vi复制和剪切命令

- y0：将光标至行首的字符拷入剪贴板。
- y$：将光标至行尾的字符拷入剪贴板。
- d0：将光标至行首的字符剪切入剪贴板。
- d1：将光标至行尾的字符剪切入剪贴板。
- range y：块复制  （range：范围）。

## 锁定屏幕

- Ctrl+S锁定屏幕（Linux通用，终端也可锁定，但是还是可执行命令。）
- Ctrl+Q解除屏幕锁定。

## 查看二进制文件

- Linux下用vi打开文件后，在命令模式下输入：%!xxd。
  %!xxd是用十六进制显示当前所编辑文件，回车即可正常显示数据。
- 编辑保存
  退出编辑时先输入:%!xxd -r，作用是将十六进制还原为二进制。

## 注释

### 方法1

- 多行注释。进入命令行模式，按ctrl + v进入 visual block模式（可视快模式），
  然后按j, 或者k选中多行，把需要注释的行标记起来
  按大写字母I，再插入注释符，
  例如//
  按两下esc键就会全部注释了。
- 取消多行注释。进入命令行模式，按ctrl + v进入 visual block模式（可视快模式），按小写字母i横向选中列的个数，例如 // 需要选中2列
  按字母j，或者k选中注释行号,或者直接按方向键选择
  按d键就可全部取消注释

### 方法2

- 在 10 - 20 行添加 // 注释

  :10,20s#^#//#g

- 在 10 - 20 行删除 // 注释

  :10,20s#^//##g

- 在 10 - 20 行添加 # 注释

  :10,20s/^/#/g

- 在 10 - 20 行删除 # 注释

   :10,20s/#//g

# 1. 复制一个单词

- 移动到单词的首字母：yw或则vey
# 2. 替换一个单词
- 先复制一个单词vey，再移动到需要替换的单词的首字母vep进行替换

# 3. 移动到下一个单词的头部

- w

# 4. 移动到前一个单词的头部

- b

# 5 . 关闭当前窗口，但是不退出vi

- bd

# 搜索字符串

正向查找：`/string`

逆向查找：`?string`

## 匹配

末尾`/string\>`

头部`/\<string`

匹配整个字符串`/\<string\>`

## 大小写

不区分大小`:set ignorecase`

区分大小写`:set noignorecase`

## 高亮搜索

高亮：`:set hlsearch`

## 递进搜索

`:set incsearch`

